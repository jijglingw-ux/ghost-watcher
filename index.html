<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PLUVO - ä»·å€¼æ•è·</title>
    
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <style>
        /* ================= åŸºç¡€è®¾ç½® ================= */
        :root {
            --bg-deep: #000000;
            --accent-cyan: #00f2ff;
            --accent-gold: #FFD700;
            --accent-red: #ff453a;
            --accent-green: #32d74b;
            --item-bg: rgba(255, 255, 255, 0.08);
            --safe-bottom: env(safe-area-inset-bottom);
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        html, body {
            margin: 0; padding: 0; background-color: #000;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            height: 100vh; height: 100dvh; width: 100vw;
            overflow: hidden; color: white; user-select: none;
        }

        .mobile-wrapper {
            width: 100%; max-width: 430px; height: 100%; margin: 0 auto;
            position: relative; background: #000;
            display: flex; flex-direction: column; overflow: hidden;
        }

        /* èƒŒæ™¯å…‰æ•ˆ */
        .glow-bg {
            position: absolute; width: 100%; height: 100%; pointer-events: none; z-index: 0;
        }
        .glow-spot-1 { position: absolute; top: -10%; left: -20%; width: 300px; height: 300px; background: radial-gradient(circle, rgba(0, 242, 255, 0.15), transparent 70%); filter: blur(80px); animation: breathe 8s infinite alternate; }
        .glow-spot-2 { position: absolute; bottom: -10%; right: -20%; width: 400px; height: 400px; background: radial-gradient(circle, rgba(255, 255, 255, 0.05), transparent 70%); filter: blur(100px); }
        @keyframes breathe { 0% {opacity:0.5; transform:scale(1);} 100% {opacity:0.8; transform:scale(1.1);} }

        /* é¡µé¢å®¹å™¨ */
        .page-view {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            transition: transform 0.3s ease-out, opacity 0.3s;
            background: #000; opacity: 0; pointer-events: none; z-index: 10;
            display: flex; flex-direction: column;
        }
        .page-view.active { opacity: 1; pointer-events: auto; z-index: 20; }

        /* --- æ‰«ç é¡µ --- */
        #tab-scan { background: #000; }
        #reader { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; background: #000; }
        #reader video { object-fit: cover !important; width: 100% !important; height: 100% !important; }

        .scan-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: radial-gradient(circle at center, transparent 30%, rgba(0,0,0,0.6) 80%);
        }
        .scan-frame {
            width: 260px; height: 260px; position: relative;
            border: 1px solid rgba(0, 242, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.1);
        }
        .laser {
            position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: var(--accent-cyan);
            box-shadow: 0 0 10px var(--accent-cyan);
            animation: scanMove 2s infinite linear;
        }
        @keyframes scanMove { 0% {top:0; opacity:0;} 10% {opacity:1;} 90% {opacity:1;} 100% {top:100%; opacity:0;} }
        .corner { position: absolute; width: 20px; height: 20px; border-color: var(--accent-cyan); border-style: solid; border-width: 0; }
        .tl { top: -2px; left: -2px; border-top-width: 3px; border-left-width: 3px; }
        .tr { top: -2px; right: -2px; border-top-width: 3px; border-right-width: 3px; }
        .bl { bottom: -2px; left: -2px; border-bottom-width: 3px; border-left-width: 3px; }
        .br { bottom: -2px; right: -2px; border-bottom-width: 3px; border-right-width: 3px; }
        .scan-tip {
            margin-top: 20px; color: #fff; font-size: 0.9rem; letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            background: rgba(0,0,0,0.4); padding: 6px 12px; border-radius: 4px;
        }

        /* --- é€šç”¨åˆ—è¡¨é¡µ UI (èµ„äº§ã€è®°å½•ã€è®¾ç½®) --- */
        .header { padding: 50px 20px 10px; z-index: 30; background: linear-gradient(180deg, #000 20%, transparent 100%); }
        .title { font-size: 1.8rem; font-weight: 800; letter-spacing: -1px; }
        .list-container { flex: 1; overflow-y: auto; padding: 10px 20px calc(90px + var(--safe-bottom)); }
        
        .card {
            display: flex; align-items: center; justify-content: space-between;
            background: var(--item-bg); backdrop-filter: blur(10px);
            margin-bottom: 12px; padding: 16px; border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.05); transition: transform 0.1s;
        }
        .card:active { transform: scale(0.98); background: rgba(255,255,255,0.1); }
        .icon-box { width: 44px; height: 44px; border-radius: 50%; background: #222; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; margin-right: 12px; border: 1px solid rgba(255,255,255,0.1); }
        .text-main { font-size: 1rem; font-weight: 600; color: #fff; margin-bottom: 3px; }
        .text-sub { font-size: 0.75rem; color: rgba(255,255,255,0.4); }
        .num-val { font-size: 1.1rem; font-weight: 700; font-family: "DIN Alternate"; color: var(--accent-gold); }
        .plus { color: var(--accent-green); }
        .minus { color: var(--accent-red); }

        .search-wrap { padding: 0 20px 10px; }
        .search-input { width: 100%; background: rgba(255,255,255,0.1); border: none; padding: 12px; border-radius: 8px; color: #fff; outline: none; }

        /* --- åº•éƒ¨å¯¼èˆª --- */
        .nav-bar {
            position: absolute; bottom: 0; left: 0; width: 100%;
            height: calc(80px + var(--safe-bottom)); padding-bottom: var(--safe-bottom);
            background: rgba(10,10,10,0.95); backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; z-index: 50;
        }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; color: #666; transition: 0.3s; cursor: pointer; }
        .nav-item.active { color: var(--accent-cyan); }
        .nav-icon { font-size: 1.5rem; margin-bottom: 4px; }
        .nav-text { font-size: 0.7rem; font-weight: 500; }

        /* --- ç™»å½•é¡µæ ·å¼ --- */
        .login-content { flex: 1; display: flex; flex-direction: column; justify-content: center; padding: 40px; }
        .logo-big { font-size: 4rem; font-weight: 900; background: -webkit-linear-gradient(#fff, #666); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .input-line { width: 100%; background: transparent; border: none; border-bottom: 1px solid #333; padding: 15px 0; color: #fff; font-size: 1.1rem; margin-bottom: 20px; outline: none; }
        .input-line:focus { border-color: var(--accent-cyan); }
        .btn-main { width: 100%; height: 56px; background: #fff; border-radius: 28px; border: none; font-size: 1.1rem; font-weight: bold; margin-top: 40px; cursor: pointer; }
        /* çº¢è‰²é€€å‡ºæŒ‰é’® */
        .btn-danger {
            width: 100%; height: 50px; background: rgba(255, 69, 58, 0.15); 
            border: 1px solid var(--accent-red); border-radius: 25px; 
            color: var(--accent-red); font-size: 1rem; font-weight: bold; 
            margin-top: 20px; cursor: pointer;
        }
        .btn-outline {
            width: 100%; height: 50px; background: transparent;
            border: 1px solid #444; border-radius: 25px;
            color: #888; font-size: 1rem; margin-top: 15px; cursor: pointer;
        }

        /* å¼¹çª— */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 100; display: none; align-items: center; justify-content: center; opacity: 0; transition: 0.2s; }
        .modal.show { opacity: 1; }
        .modal-box { width: 80%; background: #1a1a1a; border-radius: 20px; padding: 30px; text-align: center; border: 1px solid rgba(255,255,255,0.1); transform: scale(0.9); transition: 0.2s; }
        .modal.show .modal-box { transform: scale(1); }
    </style>
</head>
<body>

    <div class="mobile-wrapper">
        <div id="view-login" class="page-view active">
            <div class="glow-bg"><div class="glow-spot-1"></div><div class="glow-spot-2"></div></div>
            <div class="login-content">
                <div style="margin-bottom: 60px;">
                    <div class="logo-big">PLUVO</div>
                    <div style="color:var(--accent-cyan); letter-spacing:4px; margin-top:10px;">ä»·å€¼æ•è·ç³»ç»Ÿ</div>
                </div>
                <input type="text" id="acc" class="input-line" placeholder="æ¥å…¥è´¦å·" value="Node_01">
                <input type="password" class="input-line" placeholder="è®¿é—®å¯†é’¥" value="******">
                <button class="btn-main" onclick="doLogin()">å¯åŠ¨ç»ˆç«¯</button>
            </div>
        </div>

        <div id="view-home" class="page-view">
            
            <div id="tab-scan" class="page-view" style="display:none; z-index:21;">
                <div id="reader"></div> 
                <div class="scan-overlay"> 
                    <div class="scan-frame">
                        <div class="corner tl"></div><div class="corner tr"></div>
                        <div class="corner bl"></div><div class="corner br"></div>
                        <div class="laser"></div>
                    </div>
                    <div class="scan-tip">æ­£åœ¨æœç´¢èµ„äº§ä¿¡å·...</div>
                </div>
            </div>

            <div id="tab-assets" class="page-view" style="display:flex;">
                <div class="glow-bg"><div class="glow-spot-2"></div></div>
                <div class="header">
                    <div class="title">æ•°å­—èµ„äº§</div>
                    <div style="color:#666; font-size:0.8rem; margin-top:5px;">My Assets</div>
                </div>
                <div class="search-wrap"><input type="text" class="search-input" placeholder="æ£€ç´¢å•†æˆ·..." oninput="renderAssets(this.value)"></div>
                <div class="list-container" id="asset-list-dom"></div>
            </div>

            <div id="tab-records" class="page-view" style="display:none;">
                <div class="header">
                    <div class="title">è´¦æœ¬è®°å½•</div>
                    <div style="color:#666; font-size:0.8rem; margin-top:5px;">Transaction Logs</div>
                </div>
                <div class="list-container" id="record-list-dom">
                    <div class="card"><div><div class="text-main">ç³»ç»Ÿå¥–åŠ±</div><div class="text-sub">2026-02-01 10:00</div></div><div class="num-val plus">+500.00</div></div>
                </div>
            </div>

            <div id="tab-settings" class="page-view" style="display:none;">
                <div class="header">
                    <div class="title">ç³»ç»Ÿè®¾ç½®</div>
                    <div style="color:#666; font-size:0.8rem; margin-top:5px;">System Config</div>
                </div>
                <div class="list-container">
                    <div class="card" style="flex-direction:column; align-items:flex-start;">
                        <div style="width:100%; display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span style="color:#888; font-size:0.9rem;">å½“å‰èŠ‚ç‚¹</span>
                            <span style="color:var(--accent-green); font-size:0.8rem;">â— åœ¨çº¿</span>
                        </div>
                        <div style="font-size:1.6rem; font-weight:800; color:#fff;">Node_01</div>
                        <div style="font-size:0.8rem; color:#666; margin-top:5px;">æ¥å…¥ç‚¹: Shanghai_CN</div>
                    </div>

                    <div class="card" style="flex-direction:column; align-items:flex-start;">
                        <div style="color:#888; font-size:0.9rem; margin-bottom:10px;">èº«ä»½æ ‡è¯† (DID)</div>
                        <div style="font-family:'Courier New', monospace; color:#ccc; font-size:0.85rem; word-break:break-all;">
                            did:pluvo:7f8a9d2c-4b1e-8f3a
                        </div>
                    </div>

                    <div style="padding: 20px 0;">
                        <button class="btn-danger" onclick="doLogout()">é€€å‡ºç»ˆç«¯</button>
                        <button class="btn-outline" onclick="doLogout()">åˆ‡æ¢è´¦å·</button>
                    </div>
                    
                    <div style="text-align:center; color:#444; font-size:0.7rem; margin-top:20px;">
                        PLUVO Core v2.4.0 (Build 20260201)
                    </div>
                </div>
            </div>

            <div class="nav-bar">
                <div class="nav-item" id="nav-scan" onclick="switchTab('scan')">
                    <div class="nav-icon">ğŸ‘ï¸</div><div class="nav-text">æ•è·</div>
                </div>
                <div class="nav-item active" id="nav-assets" onclick="switchTab('assets')">
                    <div class="nav-icon">ğŸ’¼</div><div class="nav-text">æŒæœ‰</div>
                </div>
                <div class="nav-item" id="nav-records" onclick="switchTab('records')">
                    <div class="nav-icon">ğŸ“</div><div class="nav-text">è®°å½•</div>
                </div>
                <div class="nav-item" id="nav-settings" onclick="switchTab('settings')">
                    <div class="nav-icon">âš™ï¸</div><div class="nav-text">è®¾ç½®</div>
                </div>
            </div>
        </div>

        <div class="modal" id="success-modal">
            <div class="modal-box">
                <div style="font-size:3rem; margin-bottom:10px;">âš¡</div>
                <h3 style="color:#fff; margin:0 0 10px;">æ•è·æˆåŠŸ</h3>
                <p id="scan-result-text" style="color:#ccc; font-size:0.9rem; margin-bottom:20px;"></p>
                <button class="btn-main" style="height:44px; margin-top:0;" onclick="closeModal()">æ”¶ä¸‹èµ„äº§</button>
            </div>
        </div>
    </div>

    <script>
        // === æ•°æ®çŠ¶æ€ ===
        let myAssets = [
            { name: "PLUVO å®˜æ–¹", type: "Genesis", count: 500.00, icon: "P" },
            { name: "è€å¼ ç‰›è‚‰é¢", type: "é¤é¥®", count: 12.50, icon: "ğŸœ" },
            { name: "æ˜Ÿç©ºå’–å•¡", type: "é¥®å“", count: 8.00, icon: "â˜•" }
        ];

        // === æ‘„åƒå¤´æ§åˆ¶ ===
        let html5QrCode;
        let isScanning = false;

        async function startScanner() {
            if (isScanning) return;
            try {
                if(!document.getElementById("reader")) return;
                html5QrCode = new Html5Qrcode("reader");
                const config = { fps: 15, qrbox: { width: 250, height: 250 }, aspectRatio: window.innerWidth/window.innerHeight };
                await html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess);
                isScanning = true;
            } catch (err) {
                console.error(err);
                if(location.protocol !== 'https:' && location.hostname !== 'localhost') alert("éœ€HTTPSç¯å¢ƒ");
            }
        }

        async function stopScanner() {
            if (html5QrCode && isScanning) {
                try { await html5QrCode.stop(); html5QrCode.clear(); isScanning = false; } 
                catch (err) {}
            }
        }

        function onScanSuccess(decodedText) {
            stopScanner();
            const randomAmount = (Math.random() * 100).toFixed(2);
            const merchantName = "æœªçŸ¥ä¿¡å·æº " + Math.floor(Math.random()*1000);
            myAssets.unshift({ name: merchantName, type: "æ•è·", count: parseFloat(randomAmount), icon: "ğŸ‘¾" });
            
            document.getElementById('scan-result-text').innerText = `æ¥æº: ${merchantName}\nè·å–: +${randomAmount} CP`;
            const modal = document.getElementById('success-modal');
            modal.style.display = 'flex';
            setTimeout(()=>modal.classList.add('show'), 10);
            
            switchTab('assets'); 
        }

        // === ç•Œé¢é€»è¾‘ ===
        function doLogin() {
            document.getElementById('view-login').classList.remove('active');
            document.getElementById('view-home').classList.add('active');
            renderAssets();
        }

        // æ–°å¢ï¼šé€€å‡ºç™»å½•é€»è¾‘
        function doLogout() {
            if(confirm("ç¡®å®šè¦é€€å‡ºå½“å‰èŠ‚ç‚¹å—ï¼Ÿ")) {
                document.getElementById('view-home').classList.remove('active');
                document.getElementById('view-login').classList.add('active');
                // é‡ç½®åˆ°é»˜è®¤æ ‡ç­¾
                switchTab('assets');
            }
        }

        function renderAssets(filter = "") {
            const list = document.getElementById('asset-list-dom');
            list.innerHTML = "";
            myAssets.forEach(item => {
                if(item.name.includes(filter)) {
                    list.innerHTML += `
                    <div class="card">
                        <div style="display:flex; align-items:center;">
                            <div class="icon-box">${item.icon}</div>
                            <div>
                                <div class="text-main">${item.name}</div>
                                <div class="text-sub">${item.type}</div>
                            </div>
                        </div>
                        <div class="num-val plus">+${parseFloat(item.count).toFixed(2)}</div>
                    </div>`;
                }
            });
        }

        function switchTab(tabName) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('nav-'+tabName).classList.add('active');

            ['scan', 'assets', 'records', 'settings'].forEach(t => {
                const el = document.getElementById('tab-'+t);
                if(t === tabName) {
                    if(t === 'scan') {
                        el.style.display = 'block'; 
                        setTimeout(startScanner, 100); 
                    } else {
                        el.style.display = 'flex'; 
                        stopScanner(); 
                    }
                    el.classList.add('active');
                } else {
                    el.style.display = 'none';
                    el.classList.remove('active');
                }
            });
            
            if(tabName === 'assets') renderAssets();
        }

        function closeModal() {
            const modal = document.getElementById('success-modal');
            modal.classList.remove('show');
            setTimeout(()=>modal.style.display = 'none', 200);
        }
    </script>
</body>
</html>
